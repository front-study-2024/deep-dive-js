# 23장 실행 컨텍스트

## 23.1 소스코드의 타입

- 소스코드는 4가지 타입이 존재한다
    - 전역코드 : 전역에 존재하는 소스코드
    - 함수코드 : 함수 내부에 존재하는 소스코드
    - eval 코드 : 빌트인 전역함수인 eval 함수에 인수로 전달되어 실행되는 소스코드
    - 모듈 코드 : 모듈 내부에 존재하는 소스코드
- 이 소스코드 타입에 따라 실행컨텍스트를 생성하는 과정과 관리 내용이 다르다.
- 각각의 코드가 평가되면 실행컨텍스트가 생성된다.

## 23.2 소스코드의 평가와 실행

- JS 엔진은 소스코드를 2개의 과정, 소스코드 평가와 소스코드 실행 과정으로 나누어 처리한다.
    
    
- 소스코드 평가과정에서는 실행컨텍스트 생성과 변수, 함수등의 선언문만 먼저 실행하여 스코프에 등록한다.
- 평가가 끝나면 소스코드 실행 시작( 런타임). 이때 필요한 부분은 실행 컨텍스트에서 검색하고 변경된 것은 다시 스코프에 등록

## 23.3 실행 컨텍스트의 역할

- 실행 컨텍스트는 소스코드를 실행하는데 필요한 환경을 제공하고 코드의 실행결과를 관리하는 영역
- 모든 소스코드는 실행컨텍스트에 의해 실행되고 관리된다.
- 코드 실행 순서는 실행 컨텍스트 스택으로 관리한다.

## 23.4 실행 컨텍스트 스택

```jsx
const x = 1;

funtion foo(){
	const y = 2;

	function bar(){
		const z = 3;
		console.log(x+y+z);
	}
	bar();
}

foo();
```


- JS엔진인 먼저 전역코드를 평가하여 전역 실행 컨텍스트 생성
- 함수 호출 시 함수코드를 평가하여 함수 실행 컨텍스트 생성
- 실행 컨텍스트들은 스택으로 관리된다.

**실행과정**

1. 전역 실행 컨텍스트에 x와 foo 함수 등록 후 x에 1할당, foo() 실행
2. foo함수 실행 컨텍스트에 y와 bar가 등록되고, y에 2, bar() 실행
3. bar 함수 실행 컨텍스트에 z 등록 후 , z에 3을, 콘솔 실행한다.

- 실행 컨텍스트 스택은 코드의 실행 순서를 관리

## 23.5 렉시컬 환경

- 렉시컬 환경은 식별자와 식별자에 바인딩된 값, 그리고 상위스코프 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트이다.
- 스코프와 식별자를 관리한다.
- 렉시컬 환경은 키와 값을 갖는 개체형태의 스코프를 생성하여 식별자를 키로 등록하고 식별자에 바인딩된 값을 관리한다.
- 렉시컬 환경의 환경레코드 스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩 된 값을 관리하는 저장소다.

## 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

- 전역객체는 전역 코드가 평가되기 이전에 생성된다.
- 빌트인 전역 프로퍼티와 빌트인 전역 함수, 표쥰빌트인 객체가 추가되며 동작 환경에 따라 WEB API 혹은 호스트 객체를 포함한다.
- 전역객체도 Object.prototype을 상속 받는다.


### 1. 전역 실행 컨텍스트 생성

- 비어있는 전역 실행 컨텍스트 생성 후 실행 컨텍스트 스택에 푸쉬

### 2. 전역 레시컬 환경 생성

- 전역 렉시컬 환경을 생성 한 후 전역 실행컨텍스트에 바인딩
- 렉시컬 환경은 환경레코드와 외부 렉시컬 환경에 대한 참조로 구성
- 전역 변수와 전역 함수는 전역환경레코드의 BindingObject를 통해 전역객체의 프로퍼티와 메소드가 된다.
- let, const 키워드로 선언한 변수에 할당한 전역변수는 선언적 환경 레코드에 관리된다.
- const 키워드로 선언한 변수는 선언단계와 초기화 단계가 분리되어 진행한다. 이는 선언문에 도달하기 전까지 일시적 사각지대에 빠진다.
    
    
- 변수는 렉시컬 환경의 환경 레코드에 저장된다.
- 함수의 [[ThisValue]] 는 실행한 주체에 따라 결정된다. 이경우 일반함수로 foo를 실행하였으므로 this는 window를 가리킨다.


- 실행 컨텍스트 스택에서 컨텍스트가 제거되었다고 바로 렉시컬 환경까지 즉시 소멸되지는 않는다.

## 23.7 실행 컨텍스트와 블록 레벨 스코프

- var의 경우 함수단위 까지 크게 스코프를, let, const는 블록 내 스코프를 인정한다.
- if문 실행 될떄에는 그 내부 블록 스코프를 끝나면 상위 스코프로 변경된다.
